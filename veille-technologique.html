<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NOM ‚Äî Veille technologique</title>
  <link rel="stylesheet" href="site.css">
  <style>
    /* Sp√©cifiques √† la page Veille (l√©gers, r√©utilisent le look glass) */
    .feed-controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:8px }
    .feed-controls input[type="url"]{ flex:1 1 360px; min-width:220px; padding:10px 12px; border-radius:12px; border:1px solid color-mix(in srgb, var(--c-light) 12%, transparent); background:color-mix(in srgb, var(--c-glass) 10%, transparent); color:var(--c-content) }
    .feed-controls button, .feed-controls select{
      padding:10px 12px; border-radius:12px; border:1px solid color-mix(in srgb, var(--c-light) 12%, transparent);
      background:linear-gradient(180deg, color-mix(in srgb, var(--c-glass) 16%, transparent), color-mix(in srgb, var(--c-glass) 6%, transparent));
      color:var(--c-content); font-weight:700; cursor:pointer
    }
    .feed-controls .small{ padding:8px 10px; font-size:13px }
    .feed-list{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px }
    .feed-chip{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; cursor:default;
      background:linear-gradient(180deg, color-mix(in srgb, var(--c-glass) 18%, transparent), color-mix(in srgb, var(--c-glass) 8%, transparent));
      border:1px solid color-mix(in srgb, var(--c-light) 12%, transparent); font-size:12px; font-weight:700
    }
    .feed-chip button{ all:unset; cursor:pointer; padding:0 4px; line-height:1 }
    .rss-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:16px; margin-top:14px }
    .rss-card{
      padding:18px; border-radius:16px;
      background:linear-gradient(180deg, color-mix(in srgb, var(--c-glass) 12%, transparent), color-mix(in srgb, var(--c-glass) 18%, transparent));
      border:1px solid color-mix(in srgb, var(--c-light) 10%, transparent);
      backdrop-filter: blur(12px) saturate(var(--saturation));
      -webkit-backdrop-filter: blur(12px) saturate(var(--saturation));
      position:relative; overflow:hidden;
      display:flex; flex-direction:column; /* ensure footer sticks to bottom */
      min-height: 190px; /* consistent visual rhythm */
    }
    .rss-card h3{ font-size:16px; margin:0 0 6px }
    .rss-card p{ margin:0 0 10px; opacity:.85; font-size:14px; line-height:1.45; max-height:6.3em; overflow:hidden; flex:0 0 auto }
    .rss-meta{ display:flex; gap:8px; align-items:center; justify-content:space-between; font-size:12px; opacity:.8; margin-top:auto }
    .rss-source{ font-weight:700 }
    .ext{ color:inherit; text-decoration:none }
    .ext:hover{ text-decoration:underline; text-underline-offset:2px }
    .muted{ opacity:.7 }

    /* macOS-like indeterminate progress bar */
    .macbar{position:relative;height:10px;border-radius:999px;overflow:hidden;background:linear-gradient(180deg,color-mix(in srgb,var(--c-glass) 22%,transparent),color-mix(in srgb,var(--c-glass) 10%,transparent));border:1px solid color-mix(in srgb,var(--c-light) 12%, transparent);box-shadow:inset 0 2px 6px -4px color-mix(in srgb,#000 40%, transparent);}
    .macbar .bar{position:absolute;inset:1px;height:calc(100% - 2px);width:30%;border-radius:inherit;background:linear-gradient(90deg, color-mix(in srgb,#fff 40%, var(--c-action)) 0%, var(--c-action) 60%, color-mix(in srgb,#fff 40%, var(--c-action)) 100%);box-shadow:0 6px 16px -10px color-mix(in srgb,var(--c-action) 60%, transparent), inset 0 0 0 .5px color-mix(in srgb,#fff 30%, transparent);animation:macbar-move 1.2s cubic-bezier(.4,.0,.2,1) infinite alternate;}
    @keyframes macbar-move{from{left:1px; width:26%} to{left:calc(100% - 31%); width:31%}}
    @media (prefers-reduced-motion: reduce){ .macbar .bar{animation:none} }
  </style>
</head>
<body>
  <div class="page-bg"></div>

  <!-- NAV -->
  <nav class="container nav">
    <div class="nav-tabs">
      <a href="index.html" data-page="index.html">Accueil</a>
      <a href="experiences.html" data-page="experiences.html">Exp√©riences</a>
      <a href="competences.html" data-page="competences.html">Comp√©tences</a>
      <a href="veille-technologique.html" data-page="veille-technologique.html">Veille</a>
      <a href="contact.html" data-page="contact.html">Contact</a>
      <span class="nav-indicator" aria-hidden="true"></span>
    </div>
    <div class="nav-spacer"></div>
    <fieldset class="switcher">
      <legend class="switcher__legend">Choisir th√®me</legend>
      <label class="switcher__option">
        <input class="switcher__input" type="radio" name="theme" value="light" c-option="1" />
        <svg class="switcher__icon" viewBox="0 0 36 36" aria-hidden="true"><path fill="var(--c)" d="M18 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1Zm0 26a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0v-2a1 1 0 0 1 1-1ZM5 17a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1Zm22 0a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2h-2a1 1 0 0 1-1-1ZM7.7 7.7a1 1 0 0 1 1.4 0L11 9.6a1 1 0 0 1-1.4 1.4L7.7 9.1a1 1 0 0 1 0-1.4Zm14.6 14.6a1 1 0 0 1 1.4 0l1.9 1.9a1 1 0 1 1-1.4 1.4l-1.9-1.9a1 1 0 0 1 0-1.4ZM24.3 7.7a1 1 0 0 1 1.4 0 1 1 0 0 1 0 1.4L23.8 11a1 1 0 1 1-1.4-1.4l1.9-1.9ZM9.6 23.8a1 1 0 0 1 0 1.4L7.7 27.1a1 1 0 0 1-1.4-1.4l1.9-1.9a1 1 0 0 1 1.4 0ZM18 11a7 7 0 1 1 0 14a7 7 0 0 1 0-14Z"/></svg>
      </label>
      <label class="switcher__option">
        <input class="switcher__input" type="radio" name="theme" value="dark" c-option="2" checked />
        <svg class="switcher__icon" viewBox="0 0 36 36" aria-hidden="true"><path fill="var(--c)" d="M22 4a12 12 0 1 0 8.485 20.485A10 10 0 0 1 22 4Z"/></svg>
      </label>
      <label class="switcher__option">
        <input class="switcher__input" type="radio" name="theme" value="dim"  c-option="3" />
        <svg class="switcher__icon" viewBox="0 0 36 36" aria-hidden="true"><path fill="var(--c)" d="M5 21a1 1 0 0 1 0-6l26 0a1 1 0 0 1 0 6z"/></svg>
      </label>
    </fieldset>
  </nav>

  <main class="container">
    <section class="card">
      <h1>üõ∞Ô∏è Veille technologique</h1>
      <p class="lead">Derniers articles de sources officielles (Windows, Windows Server, CNIL, CERT‚ÄëFR). Activez/d√©sactivez les flux que vous souhaitez voir.</p>

      <div class="feed-controls" id="controls">
        <!-- Les contr√¥les seront rendus par le script (checkbox ON/OFF pour chaque flux) -->
      </div>

      <div class="feed-list" id="feed-list"></div>
    </section>

    <section class="card">
      <h2>Derniers articles</h2>
      <div id="loader" class="macbar" hidden><span class="bar"></span></div>
      <div id="items" class="rss-grid"></div>
      <p id="status" class="muted"></p>
    </section>
  </main>

  <footer class="container"><small>¬© <span id="year"></span> NOM ‚Äî Portfolio.</small></footer>

  <script src="script.js"></script>
  <script>
  (function(){
    // --- Flux par d√©faut (tu peux renommer les libell√©s) ---
    const DEFAULT_FEEDS = [
      { id:'win',   name:'Windows (blogs.windows.com)',       url:'https://blogs.windows.com/feed/', enabled:false },
      { id:'wsrv',  name:'Windows Server ‚Äî Updates',          url:'https://www.microsoft.com/en-us/windows-server/blog/content-type/updates/feed/', enabled:true },
      { id:'cnil',  name:'CNIL',                 url:'https://www.cnil.fr/fr/rss.xml', enabled:true },
      { id:'cert',  name:'CERT-FR (ANSSI)',                   url:'https://www.cert.ssi.gouv.fr/feed/', enabled:true },
    ];
    const STORE_KEY = 'techwatch-feeds-v1';

    const itemsEl = document.getElementById('items');
    const statusEl = document.getElementById('status');
    const controlsEl = document.getElementById('controls');
    const listEl = document.getElementById('feed-list');
    const loaderEl = document.getElementById('loader');
    const showLoader = ()=>{ if(loaderEl){ loaderEl.hidden = false; } };
    const hideLoader = ()=>{ if(loaderEl){ loaderEl.hidden = true; } };

    // --- State helpers ---
    function loadFeeds(){
      try{
        const v = JSON.parse(localStorage.getItem(STORE_KEY) || 'null');
        if(Array.isArray(v) && v.length){
          // merge avec DEFAULT_FEEDS pour garder nouveaux flux si on en ajoute plus tard
          const map = new Map(v.map(x=>[x.id, x]));
          return DEFAULT_FEEDS.map(def => Object.assign({}, def, map.get(def.id) || {}));
        }
      }catch(e){}
      return DEFAULT_FEEDS.slice();
    }
    function saveFeeds(arr){
      localStorage.setItem(STORE_KEY, JSON.stringify(arr.map(({id,name,url,enabled})=>({id,name,url,enabled}))));
    }

    // --- UI: switches + pastilles visibles ---
    function renderControls(feeds){
      controlsEl.innerHTML = '';
      // Bouton refresh
      const btn = document.createElement('button');
      btn.textContent = 'Rafra√Æchir';
      btn.className = 'small';
      btn.addEventListener('click', refresh);
      controlsEl.appendChild(btn);

      // Switches
      feeds.forEach((f, idx)=>{
        const label = document.createElement('label');
        label.className = 'switcher__option';
        label.style.width = 'auto';
        label.style.height = '42px';
        label.style.padding = '0 12px';
        label.style.borderRadius = '12px';
        label.style.border = '1px solid color-mix(in srgb, var(--c-light) 12%, transparent)';
        label.style.background = 'linear-gradient(180deg, color-mix(in srgb, var(--c-glass) 16%, transparent), color-mix(in srgb, var(--c-glass) 6%, transparent))';
        label.style.display = 'inline-flex';
        label.style.alignItems = 'center';
        label.style.gap = '10px';
        label.style.marginLeft = '8px';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!f.enabled;
        cb.id = 'cb-' + f.id;
        cb.addEventListener('change', ()=>{
          feeds[idx].enabled = cb.checked;
          saveFeeds(feeds);
          refresh();
        });

        const txt = document.createElement('span');
        txt.textContent = f.name;
        txt.style.fontWeight = '700';

        label.appendChild(cb);
        label.appendChild(txt);
        controlsEl.appendChild(label);
      });
    }

    function renderFeedChips(feeds){
      listEl.innerHTML = '';
      feeds.forEach(f=>{
        const chip = document.createElement('span');
        chip.className = 'feed-chip';
        chip.style.opacity = f.enabled ? '1' : '.45';
        chip.innerHTML = `<span>${new URL(f.url).hostname.replace('www.','')}</span>`;
        listEl.appendChild(chip);
      });
    }

    // --- Fetch & parse (RSS/Atom) ---
    async function fetchFeed(url){
      // Proxy CORS public ; remplace par "url" si ton h√©bergeur autorise les requ√™tes cross-origin
      const target = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
      const resp = await fetch(target);
      if(!resp.ok) throw new Error('HTTP ' + resp.status);
      const text = await resp.text();
      return parseXML(text, url);
    }

    function parseXML(xmlText, src){
      const doc = new DOMParser().parseFromString(xmlText, 'text/xml');

      // RSS 2.0
      let items = [...doc.querySelectorAll('item')].map(it=>({
        title: it.querySelector('title')?.textContent?.trim() || '(Sans titre)',
        link: (it.querySelector('link')?.textContent || it.querySelector('guid')?.textContent || '#').trim(),
        date: new Date(it.querySelector('pubDate')?.textContent || it.querySelector('dc\\:date')?.textContent || Date.now()),
        source: doc.querySelector('channel > title')?.textContent || new URL(src).hostname,
        desc: it.querySelector('description')?.textContent || ''
      }));

      // Atom
      if(items.length === 0){
        const entries = [...doc.querySelectorAll('entry')];
        items = entries.map(e=>({
          title: e.querySelector('title')?.textContent?.trim() || '(Sans titre)',
          link: e.querySelector('link')?.getAttribute('href') || '#',
          date: new Date(e.querySelector('updated')?.textContent || e.querySelector('published')?.textContent || Date.now()),
          source: e.querySelector('author > name')?.textContent || new URL(src).hostname,
          desc: e.querySelector('summary')?.textContent || e.querySelector('content')?.textContent || ''
        }));
      }
      return items;
    }

    function renderItems(items){
      itemsEl.innerHTML = '';
      const fmt = (d)=> isNaN(+d) ? '' : d.toLocaleString('fr-FR', { year:'numeric', month:'short', day:'2-digit' });
      items
        .sort((a,b)=> b.date - a.date)
        .slice(0, 30)
        .forEach(x=>{
          const el = document.createElement('article');
          el.className = 'rss-card';
          el.innerHTML = `
            <h3><a class="ext" href="${x.link}" target="_blank" rel="noopener noreferrer">${x.title}</a></h3>
            <p>${(x.desc || '').replace(/<[^>]+>/g,'').slice(0,220)}${(x.desc || '').length>220?'‚Ä¶':''}</p>
            <div class="rss-meta">
              <span class="rss-source">${x.source}</span>
              <span class="badge">${fmt(x.date)}</span>
            </div>`;
          itemsEl.appendChild(el);
        });
    }

    async function refresh(){
      const feeds = loadFeeds();
      renderControls(feeds);
      renderFeedChips(feeds);
      showLoader();

      const enabled = feeds.filter(f=>f.enabled);
      if(!enabled.length){
        itemsEl.innerHTML = '';
        statusEl.textContent = 'Aucun flux s√©lectionn√©.';
        hideLoader();
        return;
      }

      statusEl.textContent = 'Chargement des articles‚Ä¶';
      try{
        const results = await Promise.allSettled(enabled.map(f => fetchFeed(f.url)));
        const allItems = results.flatMap(r => r.status === 'fulfilled' ? r.value : []);
        renderItems(allItems);
        statusEl.textContent = allItems.length ? '' : 'Aucun article trouv√© sur les flux s√©lectionn√©s.';
      }catch(err){
        statusEl.textContent = 'Erreur de chargement : ' + (err.message || err);
      }finally{
        hideLoader();
      }
    }

    // First load
    refresh();
  })();
  </script>
</body>
</html>